# ============================================
# Caddyfile - Medical CRM
# ============================================

# Frontend (Vue.js SPA)
crm.fvienot.link {
    reverse_proxy frontend:8080

    header {
        X-Robots-Tag "noindex,nofollow"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

# Backend API with WebSocket support
crmapi.fvienot.link {
    reverse_proxy backend:3000

    # CORS headers
    header {
        Access-Control-Allow-Origin "https://crm.fvienot.link"
        Access-Control-Allow-Credentials "true"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS, PATCH"
        Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept, Authorization, X-Request-ID"
        Access-Control-Expose-Headers "X-Request-ID"
        Vary "Origin"
        X-Robots-Tag "noindex,nofollow"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
    }
}

# Main domain redirects to CRM
fvienot.link {
    redir https://crm.fvienot.link{uri} permanent
}
