# ============================================
# Caddyfile - OPEx_CRM
# ============================================

# Frontend (Vue.js SPA)
crm.fvienot.link {
    reverse_proxy frontend:8080

    header {
        X-Robots-Tag "noindex,nofollow"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

# Backend API with WebSocket support
crmapi.fvienot.link {
    reverse_proxy backend:3000

    # headers
    header {
        X-Robots-Tag "noindex,nofollow"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
    }
}

# Main domain redirects to CRM
fvienot.link {
    redir https://crm.fvienot.link{uri} permanent
}
